@page "/create-post"
@using ApiContracts.Post
@using BlazorApp.Services.Post
@inject IPostService PostService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<h3>Create New Post</h3>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}

<div class="card">
    <div class="card-body">
        <div class="mb-3">
            <label class="form-label">Title:</label>
            <input type="text" class="form-control" @bind="title"/>
        </div>

        <div class="mb-3">
            <label class="form-label">Body:</label>
            <textarea class="form-control" rows="5" @bind="body"></textarea>
        </div>

        <button class="btn btn-primary" @onclick="HandleCreatePost">Create
            Post
        </button>
        <button class="btn btn-secondary" @onclick="Cancel">Cancel</button>
    </div>
</div>

@code {
    private string title = string.Empty;
    private string body = string.Empty;
    private string errorMessage = string.Empty;

    private async Task HandleCreatePost()
    {
        try
        {
            errorMessage = string.Empty;

            CreatePostDto dto = new CreatePostDto
            {
                Title = title,
                Body = body,
                UserId = 1,
                SubForumId = 1 // Hardcoded
            };

            PostDto createdPost = await PostService.CreatePostAsync(dto);
            NavigationManager.NavigateTo($"/posts/{createdPost.Id}"); // Navigate to the new post
        }
        catch (Exception ex)
        {
            errorMessage = $"Error: {ex.Message}";
        }
    }

    private void Cancel()
    {
        NavigationManager.NavigateTo("/posts");
    }

}